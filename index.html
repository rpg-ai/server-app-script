<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  </head>
  <body>
    <form>
      <textarea name="playerAction" rows="4" cols="100" style="font-family:'Courier New'; font-size:16px;"></textarea>
      <input type="button" onClick="formSubmit()" value="Submit" />
    </form>
    <b><p id="pInstruction" style="font-size:24px; font-family:'Courier New';"></p></b>
    <textarea id="inputResponse" rows="4" cols="100" style="font-family:'Courier New'; font-size:16px;"></textarea>
    <button onclick="copyResponse()">Copy text</button>
    <div style="margin-bottom:10px;">
      <button onclick="randomGenerate('Quest', '')">Quest</button>
      <button onclick="randomGenerate('NPC', '')">NPC</button>
    </div>
    <div style="margin-bottom:10px;">
      <button onclick="randomGenerate('Location', '')">Location: Anywhere</button>
      <button onclick="randomGenerate('Location', 'Dungeon')">Location: Dungeon</button>
      <button onclick="randomGenerate('Location', 'Town')">Location: Town</button>
      <button onclick="randomGenerate('Location', 'Wilderness')">Location: Wilderness</button>
      <button onclick="randomGenerate('Location', 'World')">Location: World</button>
    </div>
    <div style="margin-bottom:10px;">
      <button onclick="randomGenerate('Encounter', 'Dungeon')">Encounter: in a Dungeon</button>
      <button onclick="randomGenerate('Encounter', 'Road')">Encounter: on the Road</button>
      <button onclick="randomGenerate('Encounter', 'Sea')">Encounter: at Sea</button>
      <button onclick="randomGenerate('Encounter', 'Town')">Encounter: in Town</button>
      <button onclick="randomGenerate('Encounter', 'Wilderness')">Encounter: in the Wilderness</button>
    </div>
  </body>
  <script type="text/javascript">

    function formSubmit() {
      document.getElementById('pInstruction').innerHTML = 'Loading, please wait...'
      google.script.run
        .withSuccessHandler(onSuccess)
        .withFailureHandler(onFailure)
        .messageController(document.forms[0]);
    }

    function randomGenerate(generationType, subtype) {
      document.getElementById('pInstruction').innerHTML = 'Loading, please wait...'
      google.script.run
        .withSuccessHandler(onSuccess)
        .withFailureHandler(onFailure)
        .generatorController(generationType, subtype);
    }

    function onSuccess(response) {
      document.getElementById('pInstruction').innerHTML = response.instruction
      document.getElementById("inputResponse").value = response.textToCopy
    }

    function onFailure(e){
      document.getElementById('pInstruction').innerHTML = `&#129302 - Something went wrong. ${e}`
    }

    function copyResponse() { 
      var copyText = document.getElementById("inputResponse") 
      copyText.select() 
      copyText.setSelectionRange(0, 99999) 
      document.execCommand("copy") 
    }
  </script>
</html>
